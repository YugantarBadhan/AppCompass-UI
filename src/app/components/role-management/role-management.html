<div class="role-management-container">
  <!-- Header Section -->
  <div class="header-section">
    <h2 class="page-title">Role Management</h2>
    <button
      class="btn btn-primary create-btn"
      (click)="openCreateModal()"
      [disabled]="isLoading"
    >
      <i class="icon-plus"></i>
      Create New Role
    </button>
  </div>

  <!-- Alert Messages -->
  <app-alert
    *ngIf="errorMessage"
    [message]="errorMessage"
    type="error"
    (dismissed)="errorMessage = ''"
  >
  </app-alert>

  <app-alert
    *ngIf="successMessage"
    [message]="successMessage"
    type="success"
    (dismissed)="successMessage = ''"
  >
  </app-alert>

  <!-- Loading Spinner -->
  <app-loading *ngIf="isLoading && roles.length === 0"></app-loading>

  <!-- Roles Table -->
  <div class="table-container" *ngIf="!isLoading || roles.length > 0">
    <table class="roles-table">
      <thead>
        <tr>
          <th>Role Name</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let role of roles; trackBy: trackByRoleId"
          class="table-row"
        >
          <td class="role-name" [attr.data-label]="'Role Name'">
            {{ role.name }}
          </td>
          <td [attr.data-label]="'Status'">
            <span
              class="status-badge"
              [class.active]="role.isActive"
              [class.inactive]="!role.isActive"
            >
              {{ role.isActive ? "Active" : "Inactive" }}
            </span>
          </td>
          <td class="actions-cell" [attr.data-label]="'Actions'">
            <button
              class="btn btn-secondary btn-sm action-btn"
              (click)="openEditModal(role)"
              [disabled]="isLoading || !canEditRole(role)"
              [title]="
                canEditRole(role) ? 'Edit Role' : 'Cannot edit inactive role'
              "
              [class.disabled-tooltip]="!canEditRole(role)"
            >
              <i class="icon-edit"></i>
              Edit
            </button>
            <button
              class="btn btn-sm action-btn"
              [ngClass]="getToggleButtonConfig(role).class"
              (click)="onToggleRoleStatus(role)"
              [disabled]="isLoading"
              [title]="role.isActive ? 'Deactivate Role' : 'Reactivate Role'"
            >
              <i [ngClass]="getToggleButtonConfig(role).icon"></i>
              {{ getToggleButtonConfig(role).text }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="roles.length === 0 && !isLoading">
      <div class="empty-icon">üìã</div>
      <h3>No Roles Found</h3>
      <p>Get started by creating your first role.</p>
      <button class="btn btn-primary" (click)="openCreateModal()">
        Create New Role
      </button>
    </div>
  </div>
</div>

<!-- Create Role Modal -->
<div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Create New Role</h3>
      <button class="close-btn" (click)="closeCreateModal()">&times;</button>
    </div>

    <!-- Modal-specific error message -->
    <div class="modal-alert modal-alert-error" *ngIf="createModalErrorMessage">
      <div class="modal-alert-content">
        <i class="modal-alert-icon">‚ö†Ô∏è</i>
        <span>{{ createModalErrorMessage }}</span>
        <button class="modal-alert-close" (click)="createModalErrorMessage = ''">&times;</button>
      </div>
    </div>

    <form [formGroup]="createRoleForm" (ngSubmit)="onCreateRole()">
      <div class="modal-body">
        <div class="form-group">
          <label for="createRoleName">Role Name *</label>
          <input
            type="text"
            id="createRoleName"
            formControlName="name"
            class="form-control"
            [class.error]="
              createRoleForm.get('name')?.invalid &&
              createRoleForm.get('name')?.touched
            "
            placeholder="Enter role name"
          />

          <div
            class="error-message"
            *ngIf="
              createRoleForm.get('name')?.invalid &&
              createRoleForm.get('name')?.touched
            "
          >
            <span *ngIf="createRoleForm.get('name')?.errors?.['required']">
              Role name is required
            </span>
            <span *ngIf="createRoleForm.get('name')?.errors?.['minlength']">
              Role name must be at least 2 characters long
            </span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeCreateModal()"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!isCreateFormValid"
        >
          {{ isLoading ? "Creating..." : "Create Role" }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Role Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Edit Role</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>

    <!-- Modal-specific error message -->
    <div class="modal-alert modal-alert-error" *ngIf="editModalErrorMessage">
      <div class="modal-alert-content">
        <i class="modal-alert-icon">‚ö†Ô∏è</i>
        <span>{{ editModalErrorMessage }}</span>
        <button class="modal-alert-close" (click)="editModalErrorMessage = ''">&times;</button>
      </div>
    </div>

    <form [formGroup]="editRoleForm" (ngSubmit)="onUpdateRole()">
      <div class="modal-body">
        <div class="form-group">
          <label for="editRoleName">Role Name *</label>
          <input
            type="text"
            id="editRoleName"
            formControlName="name"
            class="form-control"
            [class.error]="
              editRoleForm.get('name')?.invalid &&
              editRoleForm.get('name')?.touched
            "
            placeholder="Enter role name"
          />

          <div
            class="error-message"
            *ngIf="
              editRoleForm.get('name')?.invalid &&
              editRoleForm.get('name')?.touched
            "
          >
            <span *ngIf="editRoleForm.get('name')?.errors?.['required']">
              Role name is required
            </span>
            <span *ngIf="editRoleForm.get('name')?.errors?.['minlength']">
              Role name must be at least 2 characters long
            </span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeEditModal()"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!isEditFormValid"
        >
          {{ isLoading ? "Updating..." : "Update Role" }}
        </button>
      </div>
    </form>
  </div>
</div>