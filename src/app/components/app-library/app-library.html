<div class="app-library-container">
  <!-- Search Section -->
  <div class="search-section">
    <div class="search-container">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Search applications..." 
        [(ngModel)]="searchTerm"
        (input)="onSearchInput()"
        (keyup.enter)="onSearch()">
      <button class="search-button" (click)="onSearch()">
        <i class="fas fa-search"></i>
      </button>
    </div>
    <button class="refresh-button" (click)="refreshApplications()" [disabled]="isLoading">
      <img src="assets/images/refresh.png" alt="Refresh" class="refresh-icon" [class.spinning]="isLoading">
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading && !error" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading applications...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="error-container">
    <div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div>
    <h3 class="error-title">Unable to Load Applications</h3>
    <p class="error-message">{{ error }}</p>
    <button class="retry-button" (click)="refreshApplications()">
      <i class="fas fa-redo"></i> Try Again
    </button>
  </div>

  <!-- Application Cards -->
  <div *ngIf="!isLoading && !error && filteredApplications.length > 0" class="applications-grid">
    <div 
      *ngFor="let app of paginatedApplications" 
      class="application-card" 
      [class.flipped]="flippedCardId === app.appId"
      [class.inactive]="!app.active"
      [class.disabled]="isAnyCardFlipped() && flippedCardId !== app.appId">

      <div class="card-inner" (click)="handleCardClick(app.appId)">
        <!-- Card Front -->
        <div class="card-face card-front">
          <div class="app-icon" [style.background]="getApplicationGradient(app)">
            <i *ngIf="app.icon" [class]="'fas fa-' + app.icon"></i>
            <span *ngIf="!app.icon" class="app-initials">{{ getApplicationIcon(app) }}</span>
          </div>
          <div class="app-info">
            <h3 class="app-name">{{ app.appName }}</h3>
            <p class="app-description">{{ app.appDescription | slice:0:97 }}{{ app.appDescription.length > 97 ? '...' : '' }}</p>
            <div class="app-status">
              <span class="status-indicator" [class.active]="app.active" [class.inactive]="!app.active"></span>
              <span class="status-text">{{ app.active ? 'Active' : 'Inactive' }}</span>
            </div>
          </div>
        </div>

        <!-- Card Back -->
        <div class="card-face card-back">
          <button class="close-x-button" (click)="closeFlip($event)" title="Close">
            Ã—
          </button>
          <div class="card-back-content">
            <h3>{{ app.appName }}</h3>
            <div class="card-back-description">{{ app.appDescription }}</div>
            <div class="status-info">
              <p>Status: 
                <strong [style.color]="app.active ? '#28a745' : '#6c757d'">
                  {{ app.active ? 'Active' : 'Inactive' }}
                </strong>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No Results - Application does not exist -->
  <div *ngIf="!isLoading && !error && filteredApplications.length === 0" class="no-applications">
    <div class="no-apps-icon"><i class="fas fa-search"></i></div>
    <h3 class="no-apps-title">Application does not exist</h3>
    <p class="no-apps-message">
      <span *ngIf="searchTerm">No applications match your search "{{ searchTerm }}".</span>
      <span *ngIf="!searchTerm">No applications are available at the moment.</span>
    </p>
    <button *ngIf="searchTerm" class="clear-search-button" (click)="searchTerm = ''; onSearchInput()">Clear Search</button>
  </div>

  <!-- Enhanced Pagination -->
  <div class="pagination" *ngIf="!isLoading && !error && filteredApplications.length > 0 && totalPages > 1">
    <!-- Previous Group Button -->
    <button 
      *ngIf="canGoToPreviousGroup" 
      class="pagination-nav-button" 
      (click)="goToPreviousGroup()"
      title="Previous pages">
      <i class="fas fa-chevron-left"></i>
    </button>

    <!-- Page Numbers -->
    <button 
      *ngFor="let page of visiblePages"
      [class.active]="currentPage === page"
      (click)="changePage(page)"
      class="pagination-page-button">
      {{ page }}
    </button>

    <!-- Next Group Button -->
    <button 
      *ngIf="canGoToNextGroup" 
      class="pagination-nav-button" 
      (click)="goToNextGroup()"
      title="Next pages">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <!-- Results Summary -->
  <div class="results-summary" *ngIf="!isLoading && !error && filteredApplications.length > 0">
    <p class="summary-text">
      Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredApplications.length) }} of {{ filteredApplications.length }} applications
      <span *ngIf="searchTerm"> matching "{{ searchTerm }}"</span>
    </p>
  </div>
</div>